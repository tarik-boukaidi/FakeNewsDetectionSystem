name: SageMaker Deployment

on:
  workflow_run:
    workflows: ["SageMaker Training"]
    types:
      - completed
env:
  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  MODEL_OUTPUT: ${{ secrets.MODEL_OUTPUT }}
  ROLE_ARN: ${{ secrets.ROLE_ARN }}
  REGION_NAME: ${{ secrets.REGION_NAME }}
  SAGEMAKER_ENDPOINT: ${{ secrets.SAGEMAKER_ENDPOINT }}


jobs:
  deploy-job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.9

      - name: Install dependencies
        run: |
          pip install "sagemaker>=2.0.0,<3.0.0" pandas scikit-learn joblib

      - name: Deploy model
        run: |
          python ML/src/deploy.py
